version: "3.7"
services:
  jenkins:
    image: jenkins/jenkins:lts
    ports:
      - 8080:8080
    volumes:
      - $JENKINS_PLUGIN/target/:/var/jenkins_home/plugins
    environment:
      #- DD_AGENT_HOST=host.docker.internal
      #- AGENT_HOST=host.docker.internal
      #- DATADOG_AGENT_HOST=host.docker.internal
      - JENKINS_PLUGIN_DATADOG_API_KEY

  ## Uncomment environment variables based on your needs. Everything can be configured in jenkins /configure page as well.
  #   environment:
  #      - DATADOG_JENKINS_PLUGIN_REPORT_WITH=DSD
  #      - DATADOG_JENKINS_PLUGIN_COLLECT_BUILD_LOGS=false
  ## Set `DATADOG_JENKINS_PLUGIN_TARGET_HOST` to `dogstatsd` or `datadog` based on the container you wish to use.
  #      - DATADOG_JENKINS_PLUGIN_TARGET_HOST=dogstatsd
  #      - DATADOG_JENKINS_PLUGIN_TARGET_LOG_COLLECTION_PORT=10518
  #      - DATADOG_JENKINS_PLUGIN_TARGET_API_KEY=$JENKINS_PLUGIN_DATADOG_API_KEY

## Uncomment the section below to use the standalone DogStatsD server to send metrics to Datadog
#  dogstatsd:
#    image: datadog/dogstatsd:latest
#    environment:
#      - DD_API_KEY=$JENKINS_PLUGIN_DATADOG_API_KEY
#    ports:
#      - 8125:8125

## Uncomment the section below to use the whole Datadog Agent to send metrics (and logs) to Datadog.
## Note that it contains a DogStatsD server as well.
  datadog:
    image: datadog/agent:latest
    environment:
      - DD_ENV=drodriguezhdez_jenkins
      - DD_API_KEY=$JENKINS_PLUGIN_DATADOG_API_KEY
      - DD_LOGS_ENABLED=true
      - DD_DOGSTATSD_NON_LOCAL_TRAFFIC=true
      - DD_APM_ENABLED=true
      - DD_APM_NON_LOCAL_TRAFFIC=true
      - DD_NON_LOCAL_TRAFFIC=true
    ports:
      - 8125:8125
      - 8126:8126
      - 10518:10518
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /proc/:/host/proc/:ro
      - /sys/fs/cgroup/:/host/sys/fs/cgroup:ro
      - $JENKINS_PLUGIN/conf.yaml:/etc/datadog-agent/conf.d/jenkins.d/conf.yaml